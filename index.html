<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PD â€“ DAN 121.605</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #eef1f4;
  margin: 0;
}
header {
  background: #0b2d48;
  color: white;
  padding: 16px;
  text-align: center;
}
nav {
  display: flex;
}
nav button {
  flex: 1;
  padding: 14px;
  border: none;
  background: #d0d6dc;
  font-weight: 600;
}
nav button.active {
  background: #ffffff;
}
.container {
  padding: 16px;
}
.card {
  background: white;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}
label {
  font-weight: 600;
  margin-top: 12px;
  display: block;
}
input, select {
  width: 100%;
  padding: 10px;
  margin-top: 4px;
  border-radius: 8px;
  border: 1px solid #ccc;
}
button.calc {
  background: #0b2d48;
  color: white;
  padding: 14px;
  border: none;
  border-radius: 10px;
  width: 100%;
  font-size: 16px;
  margin-top: 16px;
}
.result {
  white-space: pre-line;
  font-size: 14px;
}
details {
  background: #f7f9fb;
  padding: 12px;
  border-radius: 10px;
}
details summary {
  font-weight: 700;
  cursor: pointer;
}
small { color:#555; }
</style>
</head>

<body>

<header>
  <h2>PerÃ­odo de Descanso</h2>
  <small>DAN 121.605 Â· ED 3 Â· Enmienda 7 Â· 02 ABR 2025</small>
</header>

<nav>
  <button id="btnVuelo" class="active" onclick="switchView('vuelo')">TripulaciÃ³n de Vuelo</button>
  <button id="btnCabina" onclick="switchView('cabina')">TripulaciÃ³n de Cabina</button>
</nav>

<div class="container">

<div class="card">
<details>
<summary>ðŸ“˜ DAN 121.605 â€“ Consulta permanente</summary>
<p>
Norma: DAN 121 â€“ OperaciÃ³n de Aeronaves<br>
Numeral: 121.605<br>
EdiciÃ³n: ED 3<br>
Enmienda: ENM 7<br>
Fecha: 02 abril 2025
</p>
<p>
Esta aplicaciÃ³n se basa exclusivamente en los numerales
<b>121.605(b)</b> y <b>121.605(c)</b>.
</p>
</details>
</div>

<!-- VUELO -->
<div id="vuelo" class="card">
<label>Inicio PSV</label>
<input type="datetime-local" id="startV">

<label>TÃ©rmino PSV</label>
<input type="datetime-local" id="endV">

<label>Â¿Cambio â‰¥ 45Â° longitud?</label>
<select id="lonV">
  <option value="no">No</option>
  <option value="si">SÃ­</option>
</select>

<button class="calc" onclick="calcVuelo()">Calcular PD</button>
<div class="result" id="resV"></div>
</div>

<!-- CABINA -->
<div id="cabina" class="card" style="display:none">
<label>Inicio PSV</label>
<input type="datetime-local" id="startC">

<label>TÃ©rmino PSV</label>
<input type="datetime-local" id="endC">

<label>Â¿Cambio â‰¥ 45Â° longitud?</label>
<select id="lonC">
  <option value="no">No</option>
  <option value="si">SÃ­</option>
</select>

<button class="calc" onclick="calcCabina()">Calcular PD</button>
<div class="result" id="resC"></div>
</div>

</div>

<script>
function switchView(v){
  vuelo.style.display = v==="vuelo"?"block":"none";
  cabina.style.display = v==="cabina"?"block":"none";
  btnVuelo.classList.toggle("active",v==="vuelo");
  btnCabina.classList.toggle("active",v==="cabina");
}

function horas(a,b){ return (b-a)/3600000; }

// ====================
// TRIPULACIÃ“N DE VUELO
// ====================
function calcVuelo(){
  const s=new Date(startV.value), e=new Date(endV.value);
  if(!s||!e||e<=s){ resV.textContent="âŒ Fechas invÃ¡lidas."; return; }

  const psv=horas(s,e);
  const PD_MIN=10;
  let pd, texto="", citas=[];

  if(psv<7){
    pd=PD_MIN;
    const nextStart=new Date(e.getTime()+pd*3600000);
    const maxNextPSV=8;

    texto+=
`PSV actual: ${psv.toFixed(2)} h
PD aplicado: ${pd} h (mÃ­nimo)

ðŸ•’ PrÃ³ximo PSV puede iniciar:
${nextStart.toLocaleString()}

â±ï¸ DuraciÃ³n mÃ¡xima del prÃ³ximo PSV:
${maxNextPSV} h

Normativa aplicada:
â€¢ DAN 121.605(b)
â€¢ DAN 121.605(b)(2)(v)
`;
    resV.textContent=texto;
    return;
  }

  if(psv<8){
    pd=PD_MIN;
    citas.push("DAN 121.605(b) â€“ PerÃ­odo de Descanso mÃ­nimo");
  } else {
    pd=11;
    citas.push("DAN 121.605(b)(2)(iii) â€“ PSV 8 h â†’ PD 11 h");
  }

  if(lonV.value==="si"){
    pd+=2;
    citas.push("DAN 121.605(b)(2)(iv) â€“ Ajuste por longitud");
  }

  resV.textContent=
`PSV: ${psv.toFixed(2)} h
PD aplicable: ${pd} h

Normativa aplicada:
â€¢ ${citas.join("\nâ€¢ ")}`;
}

// =====================
// TRIPULACIÃ“N DE CABINA
// =====================
function calcCabina(){
  const s=new Date(startC.value), e=new Date(endC.value);
  if(!s||!e||e<=s){ resC.textContent="âŒ Fechas invÃ¡lidas."; return; }

  const psv=horas(s,e);
  const tabla=[[7,10],[8,11],[9,12],[10,13],[11,14],[12,15],[13,16],[14,17],[15,18],[16,19],[17,20],[18,21],[19,22],[20,24]];
  let pd=null;

  for(const r of tabla){ if(psv<=r[0]){ pd=r[1]; break; } }

  if(pd===null){
    resC.textContent="âš ï¸ PSV fuera de tabla cabina\nDAN 121.605(c)(2)(i)";
    return;
  }

  if(lonC.value==="si") pd+=2;

  resC.textContent=
`PSV: ${psv.toFixed(2)} h
PD aplicable: ${pd} h

Normativa aplicada:
â€¢ DAN 121.605(c)(2)(i)
â€¢ DAN 121.605(c)(2)(iv)`;
}
</script>

</body>
</html>
