<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calculadora PD – DAN 121</title>
<style>
body { font-family: Arial; max-width: 600px; margin: auto; }
label { display: block; margin-top: 10px; }
button { margin-top: 15px; }
.result { margin-top: 20px; padding: 10px; background: #f2f2f2; }
</style>
</head>
<body>

<h2>Período de Descanso – DAN 121</h2>

<label>Tipo de tripulación:
<select id="tipo">
<option value="vuelo">Tripulación de Vuelo</option>
<option value="cabina">Tripulación de Cabina</option>
</select>
</label>

<label>Inicio PSV:
<input type="datetime-local" id="inicio">
</label>

<label>Término PSV:
<input type="datetime-local" id="fin">
</label>

<label>Cambio de longitud ≥ 45°:
<input type="checkbox" id="long45">
</label>

<label>Grados adicionales:
<input type="number" id="grados" value="0">
</label>

<label id="trasladoBox" style="display:none;">
Base principal:
<input type="checkbox" id="base">
</label>

<button onclick="calcular()">Calcular</button>

<div class="result" id="resultado"></div>

<script>
function calcular() {
  const tipo = tipoElem.value;
  const inicio = new Date(inicioElem.value);
  const fin = new Date(finElem.value);
  let psv = (fin - inicio) / 3600000;

  let pd = 0;

  if (tipo === "cabina") {
    const tabla = [
      [7,10],[8,11],[9,12],[10,13],[11,14],[12,15],[13,16],
      [14,17],[15,18],[16,19],[17,20],[18,21],[19,22],[20,24]
    ];
    for (let t of tabla) {
      if (psv <= t[0]) { pd = t[1]; break; }
    }
  } else {
    if (psv >= 8) pd = 11;
  }

  if (long45Elem.checked) {
    pd += 2 + Math.floor(gradosElem.value / 15) * 0.5;
  }

  if (tipo === "cabina" && pd === 10) {
    pd += baseElem.checked ? 0.75 : 0.33;
  }

  const proximo = new Date(fin.getTime() + pd * 3600000);

  resultado.innerHTML =
    `PSV: ${psv.toFixed(2)} h<br>
     PD mínimo: ${pd.toFixed(2)} h<br>
     Próximo PSV permitido: ${proximo.toLocaleString()}`;
}

const tipoElem = document.getElementById("tipo");
const inicioElem = document.getElementById("inicio");
const finElem = document.getElementById("fin");
const long45Elem = document.getElementById("long45");
const gradosElem = document.getElementById("grados");
const baseElem = document.getElementById("base");
const trasladoBox = document.getElementById("trasladoBox");
const resultado = document.getElementById("resultado");

tipoElem.onchange = () => trasladoBox.style.display =
  tipoElem.value === "cabina" ? "block" : "none";
</script>

</body>
</html>
